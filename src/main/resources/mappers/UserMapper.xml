<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.seanet.demo.mappers.UserMapper">

    <!-- 사용자 등록 -->
    <insert id="save" parameterType="com.seanet.demo.domain.UserVO">
        INSERT INTO TBL_USER (
            USER_ID,
            USER_PWD,
            USER_NM,
            NICKNAME,
            EMAIL,
            REG_DT,
            DEL_YN
        ) VALUES (
             #{userId},
             #{userPwd},
             #{userNm},
             #{nickname},
             #{email},
             GETDATE(),
             'N'
         )
    </insert>

    <!-- 사용자 ID로 조회 -->
    <select id="findByUserId" parameterType="string" resultType="com.seanet.demo.domain.UserVO">
        SELECT
            USER_ID AS userId,
            USER_PWD AS userPwd,
            USER_NM AS userNm,
            NICKNAME AS nickname,
            EMAIL AS email,
            REG_DT AS regDt,
            DEL_YN AS delYn
        FROM TBL_USER
        WHERE USER_ID = #{userId}
          AND DEL_YN = 'N'
    </select>

    <!-- 아이디 중복 확인 -->
    <select id="countByUserId" parameterType="string" resultType="long">
        SELECT COUNT(*)
        FROM TBL_USER
        WHERE USER_ID = #{userId}
          AND DEL_YN = 'N'
    </select>

    <!-- 닉네임 중복 확인 -->
    <select id="countByNickname" parameterType="string" resultType="long">
        SELECT COUNT(*)
        FROM TBL_USER
        WHERE NICKNAME = #{nickname}
          AND DEL_YN = 'N'
    </select>

    <!-- 이메일 중복 확인 -->
    <select id="countByEmail" parameterType="string" resultType="long">
        SELECT COUNT(*)
        FROM TBL_USER
        WHERE EMAIL = #{email}
          AND DEL_YN = 'N'
    </select>

    <!-- 사용자 정보 수정 -->
    <update id="update" parameterType="com.seanet.demo.domain.UserVO">
        UPDATE TBL_USER
        SET
            NICKNAME = #{nickname},
            EMAIL = #{email}
        WHERE USER_ID = #{userId}
          AND DEL_YN = 'N'
    </update>

    <!-- 비밀번호 변경 -->
    <update id="updatePassword">
        UPDATE TBL_USER
        SET
            USER_PWD = #{userPwd}
        WHERE USER_ID = #{userId}
          AND DEL_YN = 'N'
    </update>

    <!-- 사용자 삭제 (논리삭제) -->
    <update id="deleteByUserId" parameterType="string">
        UPDATE TBL_USER
        SET
            DEL_YN = 'Y'
        WHERE USER_ID = #{userId}
    </update>

</mapper>